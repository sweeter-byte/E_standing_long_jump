# 问题1：方法论与算法说明

> **文档说明**：本文档详细说明问题1（起跳/落地检测与滞空阶段分析）所采用的方法、算法和相关文献。所有引用文献均经过核实，确保真实可查。

---

## 1. 问题概述

### 1.1 任务目标

基于AI人体姿态估计技术获取的33个关键点坐标数据，完成以下任务：

1. 确定运动者在立定跳远过程中的**起跳时刻**和**落地时刻**
2. 描述**滞空阶段**（从起跳到落地）的运动过程

### 1.2 数据说明

| 项目 | 说明 |
|------|------|
| 数据来源 | 摄像头拍摄的立定跳远视频，经AI姿态估计处理 |
| 数据格式 | 每帧33个人体关键点的二维坐标 (X, Y) |
| 坐标系 | 图像坐标系，原点在左上角，Y轴向下为正 |
| 运动者 | 2人，成绩分别为1.58m和1.15m |
| 帧数 | 运动者1: 301帧，运动者2: 302帧 |

---

## 2. 人体关键点模型

### 2.1 33点人体模型

本题采用的关键点模型与Google MediaPipe Pose一致。MediaPipe Pose是Google于2020年发布的实时人体姿态估计模型，可在移动设备上实时运行。

**参考文献**：
> Bazarevsky, V., Grishchenko, I., Raveendran, K., Zhu, T., Zhang, F., & Grundmann, M. (2020). BlazePose: On-device real-time body pose tracking. *arXiv preprint arXiv:2006.10204*.
> 
> **文献内容**：该论文提出了BlazePose模型，实现了33个人体关键点的实时检测，包括面部、躯干、四肢和手脚的详细关键点。模型采用轻量级神经网络架构，可在移动设备上以30+ FPS运行。

### 2.2 立定跳远分析的核心关键点

根据立定跳远的运动学特征，本研究重点关注以下关键点：

| 关键点 | 索引 | 分析用途 |
|--------|------|----------|
| 脚踝 | 27, 28 | 起跳/落地时刻检测 |
| 脚跟 | 29, 30 | 地面接触判断 |
| 脚尖 | 31, 32 | 离地/触地辅助判断 |
| 膝关节 | 25, 26 | 腿部发力与收腿分析 |
| 髋关节 | 23, 24 | 质心估计、身体姿态 |
| 肩关节 | 11, 12 | 躯干姿态、摆臂起点 |
| 手腕 | 15, 16 | 手臂摆动分析 |

---

## 3. 坐标系验证

### 3.1 验证必要性

不同的姿态估计系统可能采用不同的坐标系约定。在进行运动分析前，必须确认Y轴方向，以确保后续计算的正确性。

### 3.2 验证方法

提取站立状态（第0帧）的关键点Y坐标，检验人体各部位的相对位置关系。在标准图像坐标系（Y轴向下为正）中，应满足：

$$Y_{\text{头部}} < Y_{\text{躯干}} < Y_{\text{下肢}}$$

### 3.3 验证结果

以运动者1第0帧数据为例：

| 部位 | Y坐标 (像素) |
|------|-------------|
| 鼻子 (点0) | 198.5 |
| 髋部中点 | 371.3 |
| 脚踝中点 | 538.3 |

**结论**：$Y_{\text{鼻子}} < Y_{\text{髋部}} < Y_{\text{脚踝}}$，确认Y轴向下为正，无需坐标反转。

### 3.4 坐标系对运动分析的影响

| 运动状态 | Y坐标变化 | 垂直速度符号 |
|----------|----------|-------------|
| 向上跳起 | 减小 | 负 |
| 最高点 | 最小值 | 零 |
| 向下落地 | 增大 | 正 |

---

## 4. 数据预处理

### 4.1 异常值来源

姿态估计可能因以下原因产生异常值：
- 遮挡导致关键点检测失败
- 快速运动导致运动模糊
- 背景干扰导致误检测

在本数据中，异常值表现为坐标值为0或出现不合理的突变。

### 4.2 异常值检测方法

采用三种方法联合检测异常值：

#### 4.2.1 零值检测

直接检测因跟踪丢失导致的零值或极小值：

$$\text{异常} \Leftarrow x < 1$$

#### 4.2.2 四分位距法 (IQR)

基于Tukey箱线图方法检测统计离群值：

$$IQR = Q_3 - Q_1$$

$$\text{异常} \Leftarrow x < Q_1 - k \cdot IQR \text{ 或 } x > Q_3 + k \cdot IQR$$

本研究取 $k = 2.0$（标准值为1.5，适当放宽以减少误判）。

**参考文献**：
> Tukey, J. W. (1977). *Exploratory Data Analysis*. Addison-Wesley.
>
> **文献内容**：该书是探索性数据分析的经典著作，提出了箱线图(Box Plot)方法用于识别数据中的离群值。书中定义了基于四分位距(IQR)的离群值判定准则，成为统计学中广泛使用的异常检测方法。

#### 4.2.3 速度突变检测

计算相邻帧之间的坐标变化（速度），检测异常大的突变：

$$v_i = x_i - x_{i-1}$$

$$z_i = \frac{|v_i - \bar{v}|}{\sigma_v}$$

$$\text{异常} \Leftarrow z_i > 4$$

#### 4.2.4 综合判定

任一方法检测到异常即标记：

$$\text{outlier\_mask} = \text{zero\_mask} \cup \text{IQR\_mask} \cup \text{velocity\_mask}$$

### 4.3 异常值修复

对检测到的异常点使用**线性插值**修复：

$$x_{\text{repair}}(t) = x(t_{\text{prev}}) + \frac{t - t_{\text{prev}}}{t_{\text{next}} - t_{\text{prev}}} \cdot [x(t_{\text{next}}) - x(t_{\text{prev}})]$$

其中 $t_{\text{prev}}$ 和 $t_{\text{next}}$ 分别为异常点前后最近的有效点。

**选择线性插值的原因**：
1. 避免高阶插值（如样条）在边界处的外推问题
2. 对短时间尺度的人体运动，线性近似足够准确
3. 计算简单，数值稳定

### 4.4 数据平滑

采用**Savitzky-Golay滤波器**进行平滑处理。该滤波器通过在滑动窗口内进行多项式最小二乘拟合来实现平滑，能够在去噪的同时较好地保持信号的峰值特征。

**参考文献**：
> Savitzky, A., & Golay, M. J. E. (1964). Smoothing and differentiation of data by simplified least squares procedures. *Analytical Chemistry*, 36(8), 1627-1639.
>
> **文献内容**：该论文提出了Savitzky-Golay滤波方法，通过在局部窗口内用多项式拟合数据点，取中心点的拟合值作为平滑结果。该方法的优点是在平滑的同时能保持信号的高阶矩特征（如峰值位置和宽度），优于简单移动平均。

**参数设置**（自适应）：

| 参数 | 取值 | 说明 |
|------|------|------|
| 窗口长度 $w$ | $\min(11, \lfloor n/3 \rfloor)$，确保为奇数 | 根据数据长度自适应 |
| 多项式阶数 $p$ | $\min(3, w-2)$ | 不超过窗口长度限制 |

---

## 5. 有效数据范围检测

### 5.1 问题背景

视频中运动员完成跳远后可能有往回走等无关动作，这些数据需要识别并剔除，以避免干扰后续分析。

### 5.2 检测策略

采用**多指标融合**方法确定有效数据范围：

#### 指标1：质心X坐标最大点

立定跳远过程中，运动员水平方向持续前进，X坐标最大点对应落地后的最远位置：

$$t_{\text{max\_x}} = \arg\max_t X_{\text{COM}}(t)$$

#### 指标2：水平速度变化

从X最大点开始，如果水平速度持续为负，说明运动员开始往回走。

**自适应阈值**：

$$v_{\text{threshold}} = -0.3 \times \sigma_{v_x}$$

其中 $\sigma_{v_x}$ 为起跳前水平速度的标准差。

**判定条件**：连续5帧满足 $v_x < v_{\text{threshold}}$

#### 指标3：脚部位置稳定性

落地后脚部Y坐标应趋于稳定，通过计算方差验证：

$$\text{Var}(Y_{\text{foot}}) < \text{threshold}$$

### 5.3 检测结果

| 运动者 | 原始帧数 | 有效范围 | 排除帧数 |
|--------|----------|----------|----------|
| 1 | 301 | 0-217 | 83 (27.6%) |
| 2 | 302 | 0-215 | 86 (28.5%) |

---

## 6. 起跳与落地时刻检测

### 6.1 立定跳远运动阶段

立定跳远可分为以下阶段：

| 阶段 | 运动特征 | Y坐标特征 |
|------|----------|----------|
| 准备阶段 | 双脚站立，身体下蹲蓄力 | 相对稳定 |
| 起跳阶段 | 双腿蹬伸，手臂上摆 | 开始减小 |
| 腾空阶段 | 双脚离地，抛物线运动 | 先减后增 |
| 落地阶段 | 双脚触地，屈膝缓冲 | 恢复稳定 |

### 6.2 检测原理

利用脚部Y坐标及其导数（速度）的变化规律：

- **起跳时刻**：脚部Y值开始显著减小，垂直速度由~0变为负值
- **最高点**：Y值达到最小，垂直速度为0
- **落地时刻**：Y值恢复到接近基准线，垂直速度由负变为~0

### 6.3 检测算法

#### 6.3.1 脚部特征提取

使用全部6个脚部关键点的平均Y坐标：

$$Y_{\text{foot}}(t) = \frac{1}{6}\sum_{i \in \{27,28,29,30,31,32\}} Y_i(t)$$

使用多点平均而非单点的原因：
- 减少单点检测误差的影响
- 更准确反映整体脚部位置
- 提高检测鲁棒性

#### 6.3.2 基准线估计

使用视频前10%帧的中位数作为站立基准：

$$n_{\text{baseline}} = \max(10, \lfloor 0.1 \times n \rfloor)$$

$$Y_{\text{baseline}} = \text{median}(Y_{\text{foot}}[0:n_{\text{baseline}}])$$

$$\sigma_{\text{baseline}} = \text{std}(Y_{\text{foot}}[0:n_{\text{baseline}}])$$

#### 6.3.3 自适应阈值设计

为适应不同运动员和视频条件，采用自适应阈值：

**高度阈值**（判断是否离地）：

$$h_{\text{threshold}} = \max(15, 3 \times \sigma_{\text{baseline}})$$

**速度阈值**（判断运动状态变化）：

$$v_{\text{threshold}} = 0.2 \times P_{90}(|v_y|)$$

其中 $P_{90}$ 表示速度绝对值的90%分位数。

#### 6.3.4 检测流程

```
算法：起跳/落地时刻检测

输入：平滑后的脚部Y坐标序列 Y_foot[]
输出：起跳帧 takeoff, 落地帧 landing

1. 计算垂直速度：v = gradient(Y_foot) × FPS
2. 估计基准线和阈值
3. 找到Y值最小点（最高点）：peak = argmin(Y_foot)
4. 从peak向前搜索起跳点：
   for i = peak down to 0:
       if Y_foot[i] > baseline - h_threshold AND |v[i]| < v_threshold:
           takeoff = i
           break
5. 从peak向后搜索落地点：
   for i = peak to n-1:
       if Y_foot[i] > baseline - h_threshold AND v[i] > -v_threshold:
           landing = i
           break
6. 返回 takeoff, landing
```

### 6.4 不确定性估计

由于视频帧率的限制，检测结果存在时间分辨率约束：

$$\Delta t = \frac{1}{\text{FPS}}$$

假设FPS=30，则时间不确定性为 ±0.033秒，对应 ±1帧。

### 6.5 检测结果

| 运动者 | 起跳帧 | 落地帧 | 滞空帧数 | 滞空时间 |
|--------|--------|--------|----------|----------|
| 1 | 120±1 | 133±1 | 14 | 0.467±0.033 s |
| 2 | 166±1 | 175±1 | 10 | 0.333±0.033 s |

---

## 7. 质心估计方法

### 7.1 简化方法

使用髋部中点作为质心的简化估计：

$$\vec{r}_{\text{COM}}^{\text{simple}} = \frac{1}{2}(\vec{r}_{\text{左髋}} + \vec{r}_{\text{右髋}})$$

该方法简单快速，但忽略了四肢位置对质心的影响。

### 7.2 加权平均方法

基于人体各部位质量比例进行加权平均，以获得更准确的质心估计。

**参考文献**：
> de Leva, P. (1996). Adjustments to Zatsiorsky-Seluyanov's segment inertia parameters. *Journal of Biomechanics*, 29(9), 1223-1230.
>
> **文献内容**：该论文对Zatsiorsky等人通过伽马射线扫描获得的人体分节惯性参数进行了调整，将参考点从骨性标志改为关节中心，使数据更适用于生物力学分析。论文提供了成年男性和女性各身体节段的质量比例、质心位置和转动惯量半径。

**身体部位质量比例**（基于de Leva, 1996）：

| 部位 | 质量比例 | 代表关键点 |
|------|----------|-----------|
| 头部 | 6.94% | 点0 (鼻) |
| 躯干 | 43.46% | 点11,12,23,24中点 |
| 上臂 | 2.71% × 2 | 点13, 14 (肘) |
| 前臂 | 1.62% × 2 | 点15, 16 (腕) |
| 手 | 0.61% × 2 | 点15, 16 |
| 大腿 | 14.16% × 2 | 点25, 26 (膝) |
| 小腿 | 4.33% × 2 | 点27, 28 (踝) |
| 脚 | 1.37% × 2 | 点29-32中点 |

**加权质心计算**：

$$\vec{r}_{\text{COM}} = \sum_{i} w_i \cdot \vec{r}_i$$

其中 $w_i$ 为各部位质量比例（归一化后），$\vec{r}_i$ 为该部位代表点坐标。

---

## 8. 关节角度分析

### 8.1 角度计算公式

对于三点 $P_1, P_2, P_3$（$P_2$ 为顶点），夹角计算使用向量点积：

$$\vec{v}_1 = P_1 - P_2$$
$$\vec{v}_2 = P_3 - P_2$$
$$\theta = \arccos\left(\frac{\vec{v}_1 \cdot \vec{v}_2}{|\vec{v}_1| \cdot |\vec{v}_2|}\right)$$

### 8.2 分析的关节

| 关节 | 三点定义 | 生物力学意义 |
|------|----------|-------------|
| 膝关节 | 髋(23/24) - 膝(25/26) - 踝(27/28) | 腿部屈伸程度 |
| 髋关节 | 肩(11/12) - 髋(23/24) - 膝(25/26) | 身体折叠程度 |
| 踝关节 | 膝(25/26) - 踝(27/28) - 脚尖(31/32) | 脚部姿态 |

### 8.3 躯干倾角

躯干方向向量（从髋部指向肩部）：

$$\vec{v}_{\text{trunk}} = \frac{\vec{r}_{\text{左肩}} + \vec{r}_{\text{右肩}}}{2} - \frac{\vec{r}_{\text{左髋}} + \vec{r}_{\text{右髋}}}{2}$$

相对垂直方向的倾角：

$$\theta_{\text{trunk}} = \arctan\left(\frac{v_{\text{trunk},x}}{-v_{\text{trunk},y}}\right)$$

- 正值：前倾
- 负值：后仰
- 零值：垂直

### 8.4 对称性分析

计算左右侧对应关节角度的差异，评估运动对称性：

$$\Delta\theta(t) = |\theta_{\text{左}}(t) - \theta_{\text{右}}(t)|$$

$$\bar{\Delta\theta} = \frac{1}{n}\sum_{t=1}^{n} \Delta\theta(t)$$

较大的不对称性可能表示：
- 技术动作不规范
- 身体能力不平衡
- 需要针对性训练

---

## 9. 起跳角度与立定跳远最优角度

### 9.1 理论背景

在经典抛体运动中，忽略空气阻力时，45°是实现最大水平距离的最优投射角度。然而，在立定跳远中，最优起跳角度显著低于45°。

**参考文献**：
> Wakai, M., & Linthorne, N. P. (2005). Optimum take-off angle in the standing long jump. *Human Movement Science*, 24(1), 81-96.
>
> **文献内容**：该研究通过让5名受试者以不同起跳角度进行最大努力跳远，使用2D视频分析方法研究了立定跳远的最优起跳角度。研究发现：
> 1. 起跳速度随起跳角度增大而减小（人体在水平方向比垂直方向能产生更大的力）
> 2. 起跳距离和落地距离随角度增大而减小（身体姿态变化）
> 3. 综合考虑这些因素，最优起跳角度约为19-27°，远低于理论值45°
> 4. 普通人的偏好角度约为34°，经过训练可降低到接近最优值

### 9.2 本研究结果对比

| 运动者 | 起跳角度 | 成绩 | 分析 |
|--------|----------|------|------|
| 1 | 36.6° | 1.58m | 接近普通人偏好角度 |
| 2 | 16.2° | 1.15m | 角度过低，可能起跳力量不足 |

---

## 10. 滞空阶段运动描述

### 10.1 阶段划分

将滞空阶段细分为三个子阶段：

1. **上升阶段**（起跳 → 最高点）
   - 身体重心上升
   - 腿部从蹬直逐渐收缩
   - 手臂完成上摆动作

2. **最高点附近**
   - 质心达到最高位置
   - 垂直速度接近零
   - 身体折叠程度最大

3. **下降阶段**（最高点 → 落地）
   - 身体重心下降
   - 双腿前伸准备落地
   - 手臂配合保持平衡

### 10.2 定量描述指标

| 类别 | 指标 | 单位 | 运动者1 | 运动者2 |
|------|------|------|---------|---------|
| 时间 | 滞空时间 | s | 0.467 | 0.333 |
| 时间 | 最高点时刻（相对起跳） | 帧 | 11 | 4 |
| 位移 | 水平位移 | px | 250 | 164 |
| 角度 | 起跳角度 | ° | 36.6 | 16.2 |
| 角度 | 膝关节范围 | ° | 112.7-152.0 | 130.4-169.8 |
| 角度 | 髋关节范围 | ° | 106.6-167.5 | 99.4-166.6 |
| 对称性 | 膝关节平均差异 | ° | 7.5 | 22.3 |
| 对称性 | 髋关节平均差异 | ° | 7.3 | 13.3 |

---

## 11. 不确定性分析

### 11.1 误差来源

| 来源 | 影响因素 | 估计量级 |
|------|----------|----------|
| 帧率限制 | 时间分辨率 | ±0.033s (30fps) |
| 姿态估计 | 关键点定位精度 | ±5-10像素 |
| 阈值选择 | 起跳/落地判定 | ±1-2帧 |
| 质心近似 | 加权模型简化 | ~5% |
| 角度计算 | 关键点误差传播 | ±2-3° |

### 11.2 结果报告规范

所有定量结果均应包含不确定性估计：

- 时间类：$t \pm \Delta t$（如 0.467±0.033 s）
- 角度类：$\theta \pm 2°$
- 位移类：报告像素值，并说明未进行米制转换

---

## 12. 主要发现与结论

### 12.1 两位运动者对比

| 指标 | 运动者1 (1.58m) | 运动者2 (1.15m) | 差异分析 |
|------|-----------------|-----------------|----------|
| 滞空时间 | 0.467s | 0.333s | 运动者1更长 |
| 水平位移 | 250px | 164px | 运动者1更大 |
| 起跳角度 | 36.6° | 16.2° | 运动者2过低 |
| 膝关节对称性 | 7.5° | 22.3° | 运动者2不对称 |
| 髋关节收缩范围 | 60.9° | 67.1° | 相近 |

### 12.2 主要发现

1. **滞空时间差异**：运动者1滞空时间比运动者2长40%，是成绩差异的重要因素

2. **起跳角度**：
   - 运动者1的36.6°接近普通人偏好值（~34°），但仍高于最优值（~22°）
   - 运动者2的16.2°过低，可能反映起跳力量不足

3. **运动对称性**：
   - 运动者2的膝关节左右差异（22.3°）显著大于运动者1（7.5°）
   - 不对称可能影响发力效率和落地稳定性

4. **技术建议**：
   - 两位运动者均可通过降低起跳角度（接近22-25°）来提升成绩
   - 运动者2应重点改善左右对称性

---

## 参考文献

[1] Bazarevsky, V., Grishchenko, I., Raveendran, K., Zhu, T., Zhang, F., & Grundmann, M. (2020). BlazePose: On-device real-time body pose tracking. *arXiv preprint arXiv:2006.10204*.

[2] Tukey, J. W. (1977). *Exploratory Data Analysis*. Addison-Wesley.

[3] Savitzky, A., & Golay, M. J. E. (1964). Smoothing and differentiation of data by simplified least squares procedures. *Analytical Chemistry*, 36(8), 1627-1639.

[4] de Leva, P. (1996). Adjustments to Zatsiorsky-Seluyanov's segment inertia parameters. *Journal of Biomechanics*, 29(9), 1223-1230.

[5] Wakai, M., & Linthorne, N. P. (2005). Optimum take-off angle in the standing long jump. *Human Movement Science*, 24(1), 81-96.

---

## 附录：代码实现概要

### 主要函数

| 函数名 | 功能 | 关键算法 |
|--------|------|----------|
| `preprocess_keypoints()` | 数据预处理 | IQR异常检测 + 线性插值 + Savitzky-Golay滤波 |
| `find_valid_range()` | 有效范围检测 | 多指标融合（X最大点 + 速度 + 稳定性） |
| `detect_jump_phases_stateful()` | 起跳/落地检测 | 自适应阈值 + 峰值搜索 |
| `calculate_weighted_com()` | 加权质心计算 | 基于de Leva(1996)的质量比例 |
| `calculate_joint_angle()` | 关节角度计算 | 向量点积公式 |
| `analyze_flight_phase()` | 滞空分析 | 综合运动学参数提取 |

### 输出文件

| 文件 | 内容 |
|------|------|
| `athlete{N}_detection.png` | 起跳/落地检测可视化 |
| `athlete{N}_flight.png` | 滞空阶段分析图表 |
| `athlete{N}_skeleton.png` | 骨架序列图 |
| `athlete{N}_preprocessing.png` | 预处理对比图 |
| `athlete{N}_results.json` | 结构化分析结果 |
| `athlete{N}_report.txt` | 文字报告 |
